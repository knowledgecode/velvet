/*
 velvet.js (c) KNOWLEDGECODE | MIT

 https://github.com/gre/bezier-easing
 BezierEasing - use bezier curve for transition easing function
 by Gaëtan Renaudeau 2014 - 2015 – MIT License
*/
(function(v){var p=function(){var a="function"===typeof Float32Array,c=function(a,c,d){return(((1-3*d+3*c)*a+(3*d-6*c))*a+3*c)*a};return function(b,e,d,h){if(!(0<=b&&1>=b&&0<=d&&1>=d))throw Error("bezier x values must be in [0, 1] range");var k=a?new Float32Array(11):Array(11);if(b!==e||d!==h)for(var f=0;11>f;++f)k[f]=c(.1*f,b,d);return function(a){if(b===e&&d===h)return a;if(0===a)return 0;if(1===a)return 1;for(var g=0,l=1;10!==l&&k[l]<=a;++l)g+=.1;--l;var l=g+(a-k[l])/(k[l+1]-k[l])*.1,f=3*(1-3*
d+3*b)*l*l+2*(3*d-6*b)*l+3*b;if(.001<=f){for(g=0;4>g;++g){f=3*(1-3*d+3*b)*l*l+2*(3*d-6*b)*l+3*b;if(0===f)break;var m=c(l,b,d)-a,l=l-m/f}a=l}else if(0===f)a=l;else{var l=g,g=g+.1,n=0;do m=l+.5*(g-l),f=c(m,b,d)-a,0<f?g=m:l=m;while(1E-7<Math.abs(f)&&10>++n);a=m}return c(a,e,h)}}}(),L={ease:p(.25,.1,.25,1),linear:p(0,0,1,1),"ease-in":p(.42,0,1,1),"ease-out":p(0,0,.58,1),"ease-in-out":p(.42,0,.58,1)},C=function(a,c){var b=["webkit","moz","ms","o"],e=c,d,h;d=0;for(h=b.length;!(e in a)&&d<h;d++)e=b[d]+c[0].toUpperCase()+
c.slice(1);return d<h?e:""},y=function(){var a=document.createElement("div");return"animate"in Element.prototype&&!!a.animate([]).play&&!!a.animate([]).effect}(),z="willChange"in document.createElement("div").style,A=function(){var a=[],c=0,b=0,e=1E3/60,d=function(){var h=Date.now(),k=Math.max(e-(h-b),0);b=h+k;return c=setTimeout(function(){var b=h+k,e,m=a.length;if(m){for(e=0;e<m;e++)a[e](b);a.splice(0,m);d()}else c=0},k)};return v[C(v,"requestAnimationFrame")]||function(b){a[a.length]=b;return c||
d()}}(),u=C(document.createElement("div").style,"transform"),M=function(){var a=document.createElement("div");a.style[u]="translateZ(0)";return!!a.style[u]}(),x=function(a,c,b){b=b||Array(a.length);for(var e=0,d=a.length;e<d;e++)b[e]=c(a[e],e);return b},m=function(a,c){for(var b=0,e=a.length;b<e;b++)c(a[b],b)},t=function(a,c){var b=(arguments.length?a+"":"").split("%s"),e=b.length-1;return c?function(a){for(var c=0,d=b[0];c<e;)d+=a[c]+b[++c];return d}:function(){for(var a=0,c=b[0];a<e;)c+=arguments[a]+
b[++a];return c}},D="translateX translateY translateZ scale scaleX scaleY scaleZ rotate rotateX rotateY rotateZ skewX skewY perspective".split(" "),N="px px px     deg deg deg deg deg deg px".split(" "),O=[0,0,0,1,1,1,1,0,0,0,0,0,0,0],E=function(){var a={},c=t("%s(%s%s)");m(D,function(b,e){a[b]=c(b,"%s",N[e])});return a}(),P=function(){var a={};m(D,function(c,b){a[c]=O[b]});return a}(),F={opacity:"%s"},Q={opacity:1},r=function(a,c){this._weavers=a;this._options=c;this._playState="running"};r.prototype._reset=
function(){"idle"!==this._playState&&"invalid"!==this._playState&&(m(this._weavers,function(a){a.cancel()}),this._playState="idle");return this};r.prototype._unravel=function(){this._options=this._weavers=void 0;this._playState="invalid"};r.prototype.play=function(){"running"!==this._playState&&"invalid"!==this._playState&&(m(this._weavers,function(a){a.play()}),this._playState="running");return this};r.prototype.cancel=function(){var a=this._playState;if("idle"!==a&&"invalid"!==a&&(this._reset(),
"finished"!==a))this._options.oncancel();return this};r.prototype.pause=function(){"running"===this._playState&&(m(this._weavers,function(a){a.pause()}),this._playState="paused");return this};r.prototype.finish=function(){var a=this._playState;"finished"!==a&&"invalid"!==a&&(m(this._weavers,function(a){a.finish()}),this._playState="finished","idle"!==a&&A(this._options.onfinish));return this};r.prototype.reverse=function(){"invalid"!==this._playState&&(m(this._weavers,function(a){a.reverse()}),this._playState=
"running");return this};r.prototype.direction=function(){var a=this._weavers[0].playbackRate||0;return 0<a?1:0>a?-1:0};r.prototype.progress=function(){return this._options.progress()};var q=function(a,c){var b=0,e=L[a.easing],d=a.duration+a.delay,h=a.duration||1,k=a.delay,f=function(g){this._reverse&&(this._reverse=!1,this.startTime=g);"running"===this.playState&&(g=this._offset+this.playbackRate*(g-this.startTime),this.currentTime=g>d?d:0>g?0:g,g>k&&g<d&&(b=e((g-k)/h),c(b)),0<=g&&g<=d?A(f):(this.playState=
"finished",this.onfinish(),a.onfinish()))}.bind(this);this.currentTime=0;this.effect={getComputedTiming:function(){return{progress:b}}};this.oncancel=function(){this._offset=this.currentTime;b=0;c(b)}.bind(this);this.onfinish=function(){this._offset=this.currentTime;b=0<this.playbackRate?1:0;c(b)}.bind(this);this.playState="running";this.playbackRate=1;this._offset=this.startTime=0;this._options=a;this._reverse=!1;this._run=function(){A(function(a){this.startTime=a;f(a)}.bind(this))}.bind(this);this._run()};
q.prototype.cancel=function(){this.currentTime=0;this.playState="idle";this.oncancel()};q.prototype.finish=function(){this.currentTime=0<this.playbackRate?this._options.duration+this._options.delay:0;this.playState="finished";this.onfinish()};q.prototype.pause=function(){this._offset=this.currentTime;this.playState="paused"};q.prototype.play=function(){if("idle"===this.playState||"finished"===this.playState)this._offset=0<this.playbackRate?0:this._options.duration+this._options.delay;this.playState=
"running";this._run()};q.prototype.reverse=function(){this.playbackRate*=-1;if("running"===this.playState)this._offset=this.currentTime,this._reverse=!0;else{if("idle"===this.playState||"finished"===this.playState)this._offset=0<this.playbackRate?0:this._options.duration+this._options.delay;this.playState="running";this._run()}};p=function(){};p.prototype.weave=function(a,c,b,e){var d=x(c,function(b,c){return b-a[c]}),h=Array(d.length),k,f;c=b.duration||0;var g=b.easing||"linear";k=new q({delay:b.delay||
0,duration:c,easing:g,onfinish:function(){f.finish.bind(f)()}},function(b){e(x(d,function(c,d){return a[d]+c*b},h))});return f=new r([k],{duration:c,easing:g,progress:function(){return k.effect.getComputedTiming().progress},oncancel:b.oncancel||function(){},onfinish:b.onfinish||function(){}})};var G=new p,H=function(a,c,b,e){m(Object.keys(a),function(d){d in E?c[d]=a[d]:d in F?b[d]=a[d]:e&&(e[d]=a[d])})},I=function(a,c){var b=Object.keys(a);m(Object.keys(c),function(a){~b.indexOf(a)||(b[b.length]=
a)});return b},J=function(a,c){var b="";m(a,function(a){b+=" "+c[a]});return b.trim()},K=function(a,c,b){var e={};m(a,function(a){e[a]=a in c?c[a]:b[a]});return e},n=function(a){this._elements="number"===typeof a.length?a:[a];this._weaver=void 0;this._transforms={};this._opacity={};this._values=this._opacityKeys=this._transformKeys=void 0};n.prototype._mergeTransformKeys=function(a){return this._transformKeys=a=I(this._transforms,a)};n.prototype._mergeOpacityKeys=function(a){return this._opacityKeys=
a=I(this._opacity,a)};n.prototype._getTransformFunctions=function(a){a=J(a,E);!y&&!z&&M&&a&&(a+=" translateZ(0)");return a};n.prototype._getOpacityFunctions=function(a){return J(a,F)};n.prototype._generateValues=function(a,c,b,e){var d=function(a,b,c){return x(a,function(a){return a in b?b[a]:c[a]})};return this._values=a=[d(a,this._transforms,P).concat(d(b,this._opacity,Q)),d(a,c,this._transforms).concat(d(b,e,this._opacity))]};n.prototype._cacheTransform=function(a,c){this._transforms=K(a,c,this._transforms)};
n.prototype._cacheOpacity=function(a,c){this._opacity=K(a,c,this._opacity)};n.prototype._pin=function(){var a={},c={},b,e,d,h,k=this._transformKeys,f=this._opacityKeys,g,n;this._weaver&&("idle"!==this._weaver._playState&&"invalid"!==this._weaver._playState&&("running"===this._weaver._playState&&this._weaver.pause(),b=this._weaver.progress(),e=this._values[0],d=this._values[1],h=x(e,function(a,c){return a+(d[c]-a)*b}),m(k,function(b,c){a[b]=h[c]}),f.length&&(c.opacity=h[h.length-1]),this._cacheTransform(k,
a),this._cacheOpacity(f,c),y&&(g=t(this._getTransformFunctions(k),!0)(h),n=t(this._getOpacityFunctions(f))(h[h.length-1]),m(this._elements,function(a){a=a.style;a[u]=g;a.opacity=n}),this._weaver._reset())),this._weaver._unravel(),this._weaver=void 0)};n.prototype.weave=function(a,c){var b={},e={},d,h,k,f,g={},n={},l=[],w,p,q,x,v=function(){};this._pin();!y&&z&&m(this._elements,function(a){a.style.willChange=u+", opacity"});H(a,b,e);d=this._mergeTransformKeys(b);h=this._mergeOpacityKeys(e);k=this._getTransformFunctions(d);
f=this._getOpacityFunctions(h);b=this._generateValues(d,b,h,e);if(y)k&&(w=t(k,!0),g[u]=w(b[0]),n[u]=w(b[1])),f&&(p=t(f),q=b[1].length-1,g.opacity=p(b[0][q]),n.opacity=p(b[1][q])),m(this._elements,function(a,b){l[b]=a.animate([g,n],{delay:c.delay||0,duration:c.duration||0,easing:c.easing||"linear",fill:"forwards"})}),l.length&&(this._weaver=new r(l,{duration:c.duration||0,easing:c.easing||"linear",progress:function(){return l[l.length-1].effect.getComputedTiming().progress||0},oncancel:function(){c.oncancel&&
c.oncancel.bind(this._weaver)()}.bind(this),onfinish:function(){c.onfinish&&c.onfinish.bind(this._weaver)()}}),l[l.length-1].onfinish=function(){"finished"!==this._weaver._playState&&(this._weaver._playState="finished",c.onfinish&&c.onfinish.bind(this._weaver)())}.bind(this));else{if(k&&f)w=t(k,!0),p=t(f),q=b[0].length-1,v=function(a){var b=w(a),c=p(a[q]);m(this._elements,function(a){a=a.style;a[u]=b;a.opacity=c})}.bind(this);else if(k||f)w=t(k||f,!0),x=k?u:"opacity",v=function(a){var b=w(a);m(this._elements,
function(a){a.style[x]=b})}.bind(this);this._weaver=G.weave(b[0],b[1],{delay:c.delay||0,duration:c.duration||0,easing:c.easing||"linear",oncancel:function(){c.oncancel&&c.oncancel.bind(this._weaver)()}.bind(this),onfinish:function(){c.onfinish&&c.onfinish.bind(this._weaver)()}.bind(this)},v)}return this._weaver};n.prototype.style=function(a){var c={},b={},e={},d,h,k,f,g;this._pin();H(a,c,b,e);a=this._mergeTransformKeys(c);d=this._mergeOpacityKeys(b);h=this._generateValues(a,c,d,b)[1];k=t(this._getTransformFunctions(a),
!0)(h);f=t(this._getOpacityFunctions(d))(h[h.length-1]);g=Object.keys(e);m(this._elements,function(a){var b=a.style;m(g,function(a){b[a]=e[a]});b[u]=k;b.opacity=f});this._cacheTransform(a,c);this._cacheOpacity(d,b);return this};n.prototype.unravel=function(){this._pin();!y&&z&&m(this._elements,function(a){a.style.willChange=""});this._elements=[];this._transforms={};this._opacity={};this._values=this._opacityKeys=this._transformKeys=void 0};var B=function(a){return a?new n(a):G};"object"===typeof module&&
"object"===typeof module.exports?module.exports=B:"function"===typeof define&&define.amd?define([],function(){return B}):v.velvet=B})(this);
