/*
 velvet.js (c) KNOWLEDGECODE | MIT
*/
(function(x){var p=function(){function a(a,c,d){return(((1-3*d+3*c)*a+(3*d-6*c))*a+3*c)*a}var c="function"===typeof Float32Array;return function(b,e,d,m){if(!(0<=b&&1>=b&&0<=d&&1>=d))throw Error("bezier x values must be in [0, 1] range");var l=c?new Float32Array(11):Array(11);if(b!==e||d!==m)for(var g=0;11>g;++g)l[g]=a(.1*g,b,d);return function(c){if(b===e&&d===m)return c;if(0===c)return 0;if(1===c)return 1;for(var h=0,k=1;10!==k&&l[k]<=c;++k)h+=.1;--k;k=h+(c-l[k])/(l[k+1]-l[k])*.1;var g=3*(1-3*d+
3*b)*k*k+2*(3*d-6*b)*k+3*b;if(.001<=g){for(h=0;4>h;++h){g=3*(1-3*d+3*b)*k*k+2*(3*d-6*b)*k+3*b;if(0===g)break;var f=a(k,b,d)-c;k-=f/g}c=k}else if(0===g)c=k;else{k=h;h+=.1;var n=0;do f=k+(h-k)/2,g=a(f,b,d)-c,0<g?h=f:k=f;while(1E-7<Math.abs(g)&&10>++n);c=f}return a(c,e,m)}}}(),K={ease:p(.25,.1,.25,1),linear:p(0,0,1,1),"ease-in":p(.42,0,1,1),"ease-out":p(0,0,.58,1),"ease-in-out":p(.42,0,.58,1)},B=function(a,c){var b=["webkit","moz","ms","o"],e=c,d;var m=0;for(d=b.length;!(e in a)&&m<d;m++)e=b[m]+c[0].toUpperCase()+
c.slice(1);return m<d?e:""},y=function(){var a=document.createElement("div");return"animate"in Element.prototype&&!!a.animate([]).play&&!!a.animate([]).effect}(),z=function(){var a=[],c=0,b=0,e=1E3/60,d=function(){var m=Date.now(),l=Math.max(e-(m-b),0);b=m+l;return c=setTimeout(function(){var b=m+l,e,f=a.length;if(f){for(e=0;e<f;e++)a[e](b);a.splice(0,f);d()}else c=0},l)};return x[B(x,"requestAnimationFrame")]||function(b){a[a.length]=b;return c||d()}}(),v=B(document.createElement("div").style,"transform"),
L=function(){var a=document.createElement("div");a.style[v]="translateZ(0)";return!!a.style[v]}(),u=function(a,c,b){b=b||Array(a.length);for(var e=0,d=a.length;e<d;e++)b[e]=c(a[e],e);return b},f=function(a,c){for(var b=0,e=a.length;b<e;b++)c(a[b],b)},t=function(a,c){var b=(arguments.length?a+"":"").split("%s"),e=b.length-1;return c?function(a){for(var c=0,d=b[0];c<e;)d+=a[c]+b[++c];return d}:function(){for(var a=0,c=b[0];a<e;)c+=arguments[a]+b[++a];return c}},C="translateX translateY translateZ scale scaleX scaleY scaleZ rotate rotateX rotateY rotateZ skewX skewY perspective".split(" "),
M="px px px     deg deg deg deg deg deg px".split(" "),N=[0,0,0,1,1,1,1,0,0,0,0,0,0,0],D=function(){var a={},c=t("%s(%s%s)");f(C,function(b,e){a[b]=c(b,"%s",M[e])});return a}(),O=function(){var a={};f(C,function(c,b){a[c]=N[b]});return a}(),E={opacity:"%s"},P={opacity:1},q=function(a,c){this._weavers=a;this._options=c;this._playState="running"};q.prototype._reset=function(){"idle"!==this._playState&&"invalid"!==this._playState&&(f(this._weavers,function(a){a.cancel()}),this._playState="idle");return this};
q.prototype._unravel=function(){this._options=this._weavers=void 0;this._playState="invalid"};q.prototype.play=function(){"running"!==this._playState&&"invalid"!==this._playState&&(f(this._weavers,function(a){a.play()}),this._playState="running");return this};q.prototype.cancel=function(){var a=this._playState;if("idle"!==a&&"invalid"!==a&&(this._reset(),"finished"!==a))this._options.oncancel();return this};q.prototype.pause=function(){"running"===this._playState&&(f(this._weavers,function(a){a.pause()}),
this._playState="paused");return this};q.prototype.finish=function(){var a=this._playState;"finished"!==a&&"invalid"!==a&&(f(this._weavers,function(a){a.finish()}),this._playState="finished","idle"!==a&&z(this._options.onfinish));return this};q.prototype.reverse=function(){"invalid"!==this._playState&&(f(this._weavers,function(a){a.reverse()}),this._playState="running");return this};q.prototype.direction=function(){var a=this._weavers[0].playbackRate||0;return 0<a?1:0>a?-1:0};q.prototype.progress=
function(){return this._options.progress()};var r=function(a,c){var b=0,e=K[a.easing],d=a.duration+a.delay,f=a.duration||1,l=a.delay,g=function(h){this._reverse&&(this._reverse=!1,this.startTime=h);"running"===this.playState&&(h=this._offset+this.playbackRate*(h-this.startTime),this.currentTime=h>d?d:0>h?0:h,h>l&&h<d&&(b=e((h-l)/f),c(b)),0<=h&&h<=d?z(g):(this.playState="finished",this.onfinish(),a.onfinish()))}.bind(this);this.currentTime=0;this.effect={getComputedTiming:function(){return{progress:b}}};
this.oncancel=function(){this._offset=this.currentTime;b=0;c(b)}.bind(this);this.onfinish=function(){this._offset=this.currentTime;b=0<this.playbackRate?1:0;c(b)}.bind(this);this.playState="running";this.playbackRate=1;this._offset=this.startTime=0;this._options=a;this._reverse=!1;this._run=function(){z(function(a){this.startTime=a;g(a)}.bind(this))}.bind(this);this._run()};r.prototype.cancel=function(){this.currentTime=0;this.playState="idle";this.oncancel()};r.prototype.finish=function(){this.currentTime=
0<this.playbackRate?this._options.duration+this._options.delay:0;this.playState="finished";this.onfinish()};r.prototype.pause=function(){this._offset=this.currentTime;this.playState="paused"};r.prototype.play=function(){if("idle"===this.playState||"finished"===this.playState)this._offset=0<this.playbackRate?0:this._options.duration+this._options.delay;this.playState="running";this._run()};r.prototype.reverse=function(){this.playbackRate*=-1;if("running"===this.playState)this._offset=this.currentTime,
this._reverse=!0;else{if("idle"===this.playState||"finished"===this.playState)this._offset=0<this.playbackRate?0:this._options.duration+this._options.delay;this.playState="running";this._run()}};p=function(){};p.prototype.weave=function(a,c,b,e){var d=u(c,function(b,c){return b-a[c]}),f=Array(d.length),l;c=b.duration||0;var g=b.easing||"linear";var h=new r({delay:b.delay||0,duration:c,easing:g,onfinish:function(){l.finish.bind(l)()}},function(b){e(u(d,function(c,d){return a[d]+c*b},f))});return l=
new q([h],{duration:c,easing:g,progress:function(){return h.effect.getComputedTiming().progress},oncancel:b.oncancel||function(){},onfinish:b.onfinish||function(){}})};var F=new p,G=function(a,c,b,e){f(Object.keys(a),function(d){d in D?c[d]=a[d]:d in E?b[d]=a[d]:e&&(e[d]=a[d])})},H=function(a,c){var b=Object.keys(a);f(Object.keys(c),function(a){~b.indexOf(a)||(b[b.length]=a)});return b},I=function(a,c){var b="";f(a,function(a){b+=" "+c[a]});return b.trim()},J=function(a,c,b){var e={};f(a,function(a){e[a]=
a in c?c[a]:b[a]});return e},n=function(a){this._elements="number"===typeof a.length?a:[a];this._weaver=void 0;this._transforms={};this._opacity={};this._values=this._opacityKeys=this._transformKeys=void 0};n.prototype._mergeTransformKeys=function(a){return this._transformKeys=a=H(this._transforms,a)};n.prototype._mergeOpacityKeys=function(a){return this._opacityKeys=a=H(this._opacity,a)};n.prototype._getTransformFunctions=function(a){a=I(a,D);!y&&L&&a&&(a+=" translateZ(0)");return a};n.prototype._getOpacityFunctions=
function(a){return I(a,E)};n.prototype._generateValues=function(a,c,b,e){var d=function(a,b,c){return u(a,function(a){return a in b?b[a]:c[a]})};return this._values=a=[d(a,this._transforms,O).concat(d(b,this._opacity,P)),d(a,c,this._transforms).concat(d(b,e,this._opacity))]};n.prototype._cacheTransform=function(a,c){this._transforms=J(a,c,this._transforms)};n.prototype._cacheOpacity=function(a,c){this._opacity=J(a,c,this._opacity)};n.prototype._pin=function(){var a={},c={},b=this._transformKeys,e=
this._opacityKeys;if(this._weaver){if("idle"!==this._weaver._playState&&"invalid"!==this._weaver._playState){"running"===this._weaver._playState&&this._weaver.pause();var d=this._weaver.progress();var m=this._values[0];var l=this._values[1];var g=u(m,function(a,b){return a+(l[b]-a)*d});f(b,function(b,c){a[b]=g[c]});e.length&&(c.opacity=g[g.length-1]);this._cacheTransform(b,a);this._cacheOpacity(e,c);if(y){var h=t(this._getTransformFunctions(b),!0)(g);var n=t(this._getOpacityFunctions(e))(g[g.length-
1]);f(this._elements,function(a){a=a.style;a[v]=h;a.opacity=n});this._weaver._reset()}}this._weaver._unravel();this._weaver=void 0}};n.prototype.weave=function(a,c){var b={},e={},d={},m={},l=[],g=function(){};this._pin();G(a,b,e);var h=this._mergeTransformKeys(b);var n=this._mergeOpacityKeys(e);var k=this._getTransformFunctions(h);var w=this._getOpacityFunctions(n);b=this._generateValues(h,b,n,e);if(y){if(k){var p=t(k,!0);d[v]=p(b[0]);m[v]=p(b[1])}if(w){var r=t(w);var u=b[1].length-1;d.opacity=r(b[0][u]);
m.opacity=r(b[1][u])}f(this._elements,function(a,b){l[b]=a.animate([d,m],{delay:c.delay||0,duration:c.duration||0,easing:c.easing||"linear",fill:"forwards"})});l.length&&(this._weaver=new q(l,{duration:c.duration||0,easing:c.easing||"linear",progress:function(){return l[l.length-1].effect.getComputedTiming().progress||0},oncancel:function(){c.oncancel&&c.oncancel.bind(this._weaver)()}.bind(this),onfinish:function(){c.onfinish&&c.onfinish.bind(this._weaver)()}.bind(this)}),l[l.length-1].onfinish=function(){"finished"!==
this._weaver._playState&&(this._weaver._playState="finished",c.onfinish&&c.onfinish.bind(this._weaver)())}.bind(this))}else{if(k&&w)p=t(k,!0),r=t(w),u=b[0].length-1,g=function(a){var b=p(a),c=r(a[u]);f(this._elements,function(a){a=a.style;a[v]=b;a.opacity=c})}.bind(this);else if(k||w){p=t(k||w,!0);var x=k?v:"opacity";g=function(a){var b=p(a);f(this._elements,function(a){a.style[x]=b})}.bind(this)}this._weaver=F.weave(b[0],b[1],{delay:c.delay||0,duration:c.duration||0,easing:c.easing||"linear",oncancel:function(){c.oncancel&&
c.oncancel.bind(this._weaver)()}.bind(this),onfinish:function(){c.onfinish&&c.onfinish.bind(this._weaver)()}.bind(this)},g)}return this._weaver};n.prototype.style=function(a){var c={},b={},e={};this._pin();G(a,c,b,e);a=this._mergeTransformKeys(c);var d=this._mergeOpacityKeys(b);var m=this._generateValues(a,c,d,b)[1];var l=t(this._getTransformFunctions(a),!0)(m);var g=t(this._getOpacityFunctions(d))(m[m.length-1]);var h=Object.keys(e);f(this._elements,function(a){var b=a.style;f(h,function(a){b[a]=
e[a]});b[v]=l;b.opacity=g});this._cacheTransform(a,c);this._cacheOpacity(d,b);return this};n.prototype.unravel=function(){this._pin();this._elements=[];this._transforms={};this._opacity={};this._values=this._opacityKeys=this._transformKeys=void 0};var A=function(a){return a?new n(a):F};"object"===typeof module&&"object"===typeof module.exports?module.exports=A:"function"===typeof define&&define.amd?define([],function(){return A}):x.velvet=A})(this);
